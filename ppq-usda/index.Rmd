---
title: "One line, two lines; red line, blue line."
author: "Stephen E. Lane"
output:
  xaringan::moon_reader:
    includes:
      in_header: ../assets/partials/header.html
      after_body: ../assets/partials/footer.html
    css: ../assets/css/grey.css
    nature:
      highlightStyle: dracula
      highlightLines: true
      countIncrementalSlides: false
      ratio: "16:9"
---

<!-- Time-stamp: <2018-05-30 12:51:01 (slane)> -->

```{r setup,echo=FALSE,warning=FALSE,message=FALSE,cache=FALSE,results="hide"}
library(dplyr)
knitr::opts_chunk$set(cache = FALSE, error = FALSE, warning = FALSE,
                      message = FALSE, echo = TRUE)
options(digits = 2)

```

background-image: url(img/redpill-bluepill.jpeg)
background-size: cover

---
class: inverse, center, middle
background-image: 

# Sampling From Multiple Lines

---
layout: true
class: left, top
background-image: url(../assets/logos/CEBRALogo-01.svg)
background-size: 215px
background-position: right top

---

# ISPM 31

A lot to be sampled should be a number of units of a single commodity identifiable by its homogeneity in factors such as:

.pull-left[
- origin
- grower
- packing facility
- species, variety, or degree of maturity
- exporter
]

.pull-right[
- area of production
- regulated pests and their characteristics
- treatment at origin
- type of processing.
]

---

# Heterogeneous Consignments

.pull-left[
![](img/VegCorn.jpg)
<!-- var rugosa -->
]

.pull-right[
![](img/800px-Corncobs.jpg)
<!-- var indurata -->

.footnote[

.right[

<a rel="license" href="https://creativecommons.org/licenses/by-sa/2.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/2.0/80x15.png" /></a> [Sam Fentress](https://commons.wikimedia.org/wiki/File:Corncobs.jpg)

]

]

]

---

# The Regulator

Suppose the regulator is happy to apply a compliance rule across an entire consignment. Then:

- the *consignment* is compliant if the sample (across multiple lines) returns no contaminated items
- if contaminated items are found, the *whole* consignment is rejected

---
class: center, middle

# The Problem

.bigr[
How then, do we sample from each line, without making assumptions about individual line prevalences?
]

--

# The Solution

.bigr[
<span style="color:#f92672">By sampling proportional to the line volumes.</span>
]

---

# The Setup

Assume there are $K$ lines, with $N_{k}$ units in the $k$<sup>th</sup> line making a total of $N = \sum_{k} N_{k}$ units. If the contamination rate in line $k$ is $p_{k}$ then the joint contamination rate, $p$, satisfies $\sum_{k} N_{k} p_{k} = N \cdot p$.

Fix the total number of units sampled $n$, and choose some fixed weights $w_{k}$ such that $\sum_k w_{k} = 1$ and $n_{k} = n w_{k}$.

The sensitivity of inspection is
$$
\begin{align}
  S = 1 - \prod_{k=1}^{K} (1 - p_{k}) ^ {n_{k}}
\end{align}
$$

---

# The Line Prevalences

With our sample size $n$ and weights $w_{k}$ fixed, we can find the line prevalences that will minimise the sensitivity as
$$
\begin{align}
  1 -  p_{k} = (1 - p) w_{k} \frac{N}{N_{k}}
\end{align}
$$

--

> Note: this is true for any set of fixed weights, and should alert you to what form the $w_{k}$ should take!

Thus, if we take our weights as proportional to the line volumes, sensitivity is *minimised* when all line prevalences are equal to the joint contamination rate $p$.

---

# The Sample

Recall the sensitivity:
$$
\begin{align}
  S = 1 - \prod_{k=1}^{K} (1 - p_{k}) ^ {n_{k}}
\end{align}
$$

Substituting $p_{k} = p$, gives the familiar sample size formula:
$$
\begin{align}
  n = \log(1 - S) / \log(1 - p)
\end{align}
$$

Which we divvy up by sampling (at random) $n_{k} = n\frac{N_{k}}{N}$ units from line $k$.

---
class: center, middle

# Imperfect Detection

.bigr[
What about it?
]

---
class: center, middle

# No Worries

![](img/no-worries.gif)

---
class: center, middle

![](img/abilities-vixens-lightning.png)

.logo-overlay[![](../assets/logos/fast-banana.svg)]

---
class: top, left

# Colophon

<i class="fa fa-twitter fa-2x" aria-hidden="true"></i>.bigr[[@mytwitter](https://twitter.com/)]

<i class="fa fa-github fa-2x" aria-hidden="true"></i>.bigr[[mygithub](https://github.com)]

<i class="fa fa-user fa-2x" aria-hidden="true"></i>.bigr[[https://www.example.com/](https://www.example.com/)]

</br>

.footnote[
All views presented within are the author's only, and do not necessarily represent the views of the author.
]
